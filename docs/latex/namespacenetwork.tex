\doxysection{network Namespace Reference}
\hypertarget{namespacenetwork}{}\label{namespacenetwork}\index{network@{network}}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacenetwork_ad1450edd32b2488fa2e14e6e63d066f5}{send\+\_\+image\+\_\+via\+\_\+tcp}} (config, dest\+\_\+handle, filepath, peer\+\_\+ip, peer\+\_\+port)
\item 
\mbox{\hyperlink{namespacenetwork_a4e70165338540f9bcd66201130a4adcb}{network\+\_\+process}} (config, ui2net, net2ui)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{namespacenetwork_a761bf8a9cd29d8e3f0f59e7733bcd083}{MAX\+\_\+\+UDP\+\_\+\+SIZE}} = 65507
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}@file network.py
@brief Handles peer-to-peer communication over UDP and TCP for the chat system.
@details This module is responsible for:
 - Receiving and sending chat messages via UDP
 - Transferring image files via TCP
 - Handling AFK (away) logic and auto-replies
 - Managing JOIN, WHO, and LEAVE events
\end{DoxyVerb}
 

\label{doc-func-members}
\Hypertarget{namespacenetwork_doc-func-members}
\doxysubsection{Function Documentation}
\Hypertarget{namespacenetwork_a4e70165338540f9bcd66201130a4adcb}\index{network@{network}!network\_process@{network\_process}}
\index{network\_process@{network\_process}!network@{network}}
\doxysubsubsection{\texorpdfstring{network\_process()}{network\_process()}}
{\footnotesize\ttfamily \label{namespacenetwork_a4e70165338540f9bcd66201130a4adcb} 
network.\+network\+\_\+process (\begin{DoxyParamCaption}\item[{}]{config}{, }\item[{}]{ui2net}{, }\item[{}]{net2ui}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}@brief Main process that manages all network communication.
@param config Client configuration dictionary
@param ui2net Pipe for commands coming from the UI
@param net2ui Pipe for sending updates to the UI
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{network_8py_source_l00051}{51}} of file \mbox{\hyperlink{network_8py_source}{network.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00051\ \textcolor{keyword}{def\ }network\_process(config,\ ui2net,\ net2ui):}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00053\ \textcolor{stringliteral}{\ \ \ \ @brief\ Main\ process\ that\ manages\ all\ network\ communication.}}
\DoxyCodeLine{00054\ \textcolor{stringliteral}{\ \ \ \ @param\ config\ Client\ configuration\ dictionary}}
\DoxyCodeLine{00055\ \textcolor{stringliteral}{\ \ \ \ @param\ ui2net\ Pipe\ for\ commands\ coming\ from\ the\ UI}}
\DoxyCodeLine{00056\ \textcolor{stringliteral}{\ \ \ \ @param\ net2ui\ Pipe\ for\ sending\ updates\ to\ the\ UI}}
\DoxyCodeLine{00057\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{00058\ \ \ \ \ handle\ =\ config[\textcolor{stringliteral}{"{}handle"{}}]}
\DoxyCodeLine{00059\ \ \ \ \ port\ =\ config[\textcolor{stringliteral}{"{}port"{}}][0]}
\DoxyCodeLine{00060\ \ \ \ \ whoisport\ =\ config[\textcolor{stringliteral}{"{}whoisport"{}}]}
\DoxyCodeLine{00061\ \ \ \ \ peers\ =\ config[\textcolor{stringliteral}{"{}peers"{}}]}
\DoxyCodeLine{00062\ \ \ \ \ autoreply\ =\ config[\textcolor{stringliteral}{"{}autoreply"{}}]}
\DoxyCodeLine{00063\ \ \ \ \ away\ =\ config.get(\textcolor{stringliteral}{"{}away"{}},\ \textcolor{keyword}{False})}
\DoxyCodeLine{00064\ \ \ \ \ img\_path\ =\ config[\textcolor{stringliteral}{"{}imagepath"{}}]}
\DoxyCodeLine{00065\ \ \ \ \ os.makedirs(img\_path,\ exist\_ok=\textcolor{keyword}{True})}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ afk\_replied\_to\ =\ set()}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{\#\ Create\ UDP\ socket}}
\DoxyCodeLine{00070\ \ \ \ \ udp\_sock\ =\ socket.socket(socket.AF\_INET,\ socket.SOCK\_DGRAM)}
\DoxyCodeLine{00071\ \ \ \ \ udp\_sock.setsockopt(socket.SOL\_SOCKET,\ socket.SO\_REUSEADDR,\ 1)}
\DoxyCodeLine{00072\ \ \ \ \ udp\_sock.setsockopt(socket.SOL\_SOCKET,\ socket.SO\_BROADCAST,\ 1)}
\DoxyCodeLine{00073\ \ \ \ \ udp\_sock.bind((\textcolor{stringliteral}{"{}"{}},\ port))}
\DoxyCodeLine{00074\ \ \ \ \ udp\_sock.setblocking(\textcolor{keyword}{False})}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{def\ }send\_periodic\_join():}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ \textcolor{keyword}{True}:}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ f\textcolor{stringliteral}{"{}JOIN\ \{handle\}\ \{port\}"{}}.encode(\textcolor{stringliteral}{"{}utf-\/8"{}})}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ udp\_sock.sendto(msg,\ (\textcolor{stringliteral}{"{}255.255.255.255"{}},\ whoisport))}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}[JOIN]\ Error:\ \{e\}"{}})}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ time.sleep(5)}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keyword}{def\ }send\_periodic\_who():}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ \textcolor{keyword}{True}:}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ udp\_sock.sendto(b\textcolor{stringliteral}{"{}WHO"{}},\ (\textcolor{stringliteral}{"{}255.255.255.255"{}},\ whoisport))}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}[WHO]\ Error:\ \{e\}"{}})}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ time.sleep(5)}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ threading.Thread(target=send\_periodic\_join,\ daemon=\textcolor{keyword}{True}).start()}
\DoxyCodeLine{00094\ \ \ \ \ threading.Thread(target=send\_periodic\_who,\ daemon=\textcolor{keyword}{True}).start()}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordflow}{while}\ \textcolor{keyword}{True}:}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ui2net.poll():}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ cmd,\ dest,\ payload\ =\ ui2net.recv()}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ cmd\ ==\ \textcolor{stringliteral}{"{}EXIT"{}}:}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{"{}[NETWORK]\ Exiting.\ Notifying\ peers."{}})}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ h,\ ip,\ pt\ \textcolor{keywordflow}{in}\ peers:}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ udp\_sock.sendto(f\textcolor{stringliteral}{"{}LEAVE\ \{handle\}"{}}.encode(\textcolor{stringliteral}{"{}utf-\/8"{}}),\ (ip,\ pt))}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}[LEAVE]\ Error\ for\ \{h\}:\ \{e\}"{}})}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ cmd\ ==\ \textcolor{stringliteral}{"{}MSG"{}}:}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ header\ =\ f\textcolor{stringliteral}{"{}MSG\ \{handle\}\ \{dest\}\ \{payload\}"{}}.encode(\textcolor{stringliteral}{"{}utf-\/8"{}})}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ h,\ ip,\ pt\ \textcolor{keywordflow}{in}\ peers:}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ h\ ==\ dest:}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ udp\_sock.sendto(header,\ (ip,\ pt))}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ cmd\ ==\ \textcolor{stringliteral}{"{}IMG"{}}:}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ h,\ ip,\ pt\ \textcolor{keywordflow}{in}\ peers:}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ h\ ==\ dest:}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ send\_image\_via\_tcp(config,\ dest,\ payload,\ ip,\ pt)}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ cmd\ ==\ \textcolor{stringliteral}{"{}LEAVE"{}}:}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ h,\ ip,\ pt\ \textcolor{keywordflow}{in}\ peers:}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ udp\_sock.sendto(f\textcolor{stringliteral}{"{}LEAVE\ \{handle\}"{}}.encode(\textcolor{stringliteral}{"{}utf-\/8"{}}),\ (ip,\ pt))}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ cmd\ ==\ \textcolor{stringliteral}{"{}AFK"{}}:}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ payload.strip().upper()}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ away\ =\ (status\ ==\ \textcolor{stringliteral}{"{}ON"{}})}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config[\textcolor{stringliteral}{"{}away"{}}]\ =\ away}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ away:}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ afk\_replied\_to.clear()}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}[NETWORK]\ AFK\ set\ to\ \{away\}"{}})}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ data,\ addr\ =\ udp\_sock.recvfrom(MAX\_UDP\_SIZE)}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ BlockingIOError:}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ time.sleep(0.01)}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ text\ =\ data.decode(\textcolor{stringliteral}{"{}utf-\/8"{}}).strip()}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ UnicodeDecodeError:}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ text:}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ parts\ =\ text.split()}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ cmd\ =\ parts[0]}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ cmd\ ==\ \textcolor{stringliteral}{"{}MSG"{}}\ \textcolor{keywordflow}{and}\ len(parts)\ >=\ 4:}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ src,\ dest\ =\ parts[1],\ parts[2]}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}\ "{}}.join(parts[3:])}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ dest\ ==\ handle:}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ net2ui.send((\textcolor{stringliteral}{"{}MSG"{}},\ src,\ msg))}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ away\ \textcolor{keywordflow}{and}\ src\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ afk\_replied\_to:}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reply\ =\ f\textcolor{stringliteral}{"{}MSG\ \{handle\}\ \{src\}\ \{autoreply\}"{}}.encode(\textcolor{stringliteral}{"{}utf-\/8"{}})}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ udp\_sock.sendto(reply,\ addr)}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ afk\_replied\_to.add(src)}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ cmd\ ==\ \textcolor{stringliteral}{"{}IMG"{}}\ \textcolor{keywordflow}{and}\ len(parts)\ ==\ 5:}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ src,\ dest,\ tcp\_port\_s,\ size\_s\ =\ parts[1],\ parts[2],\ parts[3],\ parts[4]}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ dest\ !=\ handle:}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ tcp\_port\ =\ int(tcp\_port\_s)}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ size\ =\ int(size\_s)}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ client\ =\ socket.socket(socket.AF\_INET,\ socket.SOCK\_STREAM)}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ client.connect((addr[0],\ tcp\_port))}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ buf\ =\ b\textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ len(buf)\ <\ size:}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chunk\ =\ client.recv(4096)}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ chunk:}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break}}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buf\ +=\ chunk}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ client.close()}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ fn\ =\ os.path.join(img\_path,\ f\textcolor{stringliteral}{"{}\{src\}\_\{int(time.time())\}.png"{}})}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ open(fn,\ \textcolor{stringliteral}{"{}wb"{}})\ \textcolor{keyword}{as}\ f:}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.write(buf)}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ net2ui.send((\textcolor{stringliteral}{"{}IMG"{}},\ src,\ fn))}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ cmd\ ==\ \textcolor{stringliteral}{"{}LEAVE"{}}\ \textcolor{keywordflow}{and}\ len(parts)\ ==\ 2:}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ leaver\ =\ parts[1]}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ net2ui.send((\textcolor{stringliteral}{"{}LEAVE"{}},\ leaver,\ \textcolor{stringliteral}{"{}"{}}))}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ peers[:]\ =\ [p\ \textcolor{keywordflow}{for}\ p\ \textcolor{keywordflow}{in}\ peers\ \textcolor{keywordflow}{if}\ p[0]\ !=\ leaver]}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ cmd\ ==\ \textcolor{stringliteral}{"{}KNOWUSERS"{}}:}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ rest\ =\ text[len(\textcolor{stringliteral}{"{}KNOWUSERS\ "{}}):]}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ chunk\ \textcolor{keywordflow}{in}\ rest.split(\textcolor{stringliteral}{"{},"{}}):}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ chunk.strip():}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ h,\ ip,\ pt\ =\ chunk.strip().split()}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry\ =\ (h,\ ip,\ int(pt))}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ h\ !=\ handle\ \textcolor{keywordflow}{and}\ entry\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ peers:}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ peers.append(entry)}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}[KNOWUSERS]\ Added:\ \{entry\}"{}})}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ ValueError:}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ time.sleep(0.01)}

\end{DoxyCode}
\Hypertarget{namespacenetwork_ad1450edd32b2488fa2e14e6e63d066f5}\index{network@{network}!send\_image\_via\_tcp@{send\_image\_via\_tcp}}
\index{send\_image\_via\_tcp@{send\_image\_via\_tcp}!network@{network}}
\doxysubsubsection{\texorpdfstring{send\_image\_via\_tcp()}{send\_image\_via\_tcp()}}
{\footnotesize\ttfamily \label{namespacenetwork_ad1450edd32b2488fa2e14e6e63d066f5} 
network.\+send\+\_\+image\+\_\+via\+\_\+tcp (\begin{DoxyParamCaption}\item[{}]{config}{, }\item[{}]{dest\+\_\+handle}{, }\item[{}]{filepath}{, }\item[{}]{peer\+\_\+ip}{, }\item[{}]{peer\+\_\+port}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}@brief Sends an image file to a peer using TCP.
@param config Dictionary containing local client config
@param dest_handle Destination handle (username)
@param filepath Path to the image to send
@param peer_ip IP address of the peer
@param peer_port UDP port of the peer
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{network_8py_source_l00019}{19}} of file \mbox{\hyperlink{network_8py_source}{network.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00019\ \textcolor{keyword}{def\ }send\_image\_via\_tcp(config,\ dest\_handle,\ filepath,\ peer\_ip,\ peer\_port):}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00021\ \textcolor{stringliteral}{\ \ \ \ @brief\ Sends\ an\ image\ file\ to\ a\ peer\ using\ TCP.}}
\DoxyCodeLine{00022\ \textcolor{stringliteral}{\ \ \ \ @param\ config\ Dictionary\ containing\ local\ client\ config}}
\DoxyCodeLine{00023\ \textcolor{stringliteral}{\ \ \ \ @param\ dest\_handle\ Destination\ handle\ (username)}}
\DoxyCodeLine{00024\ \textcolor{stringliteral}{\ \ \ \ @param\ filepath\ Path\ to\ the\ image\ to\ send}}
\DoxyCodeLine{00025\ \textcolor{stringliteral}{\ \ \ \ @param\ peer\_ip\ IP\ address\ of\ the\ peer}}
\DoxyCodeLine{00026\ \textcolor{stringliteral}{\ \ \ \ @param\ peer\_port\ UDP\ port\ of\ the\ peer}}
\DoxyCodeLine{00027\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{00028\ \ \ \ \ handle\ =\ config[\textcolor{stringliteral}{"{}handle"{}}]}
\DoxyCodeLine{00029\ \ \ \ \ data\ =\ open(filepath,\ \textcolor{stringliteral}{"{}rb"{}}).read()}
\DoxyCodeLine{00030\ \ \ \ \ size\ =\ len(data)}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \ \ server\ =\ socket.socket(socket.AF\_INET,\ socket.SOCK\_STREAM)}
\DoxyCodeLine{00033\ \ \ \ \ server.bind((\textcolor{stringliteral}{"{}"{}},\ 0))}
\DoxyCodeLine{00034\ \ \ \ \ server.listen(1)}
\DoxyCodeLine{00035\ \ \ \ \ tcp\_port\ =\ server.getsockname()[1]}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{comment}{\#\ Notify\ recipient\ of\ incoming\ image\ via\ UDP}}
\DoxyCodeLine{00038\ \ \ \ \ udp\ =\ socket.socket(socket.AF\_INET,\ socket.SOCK\_DGRAM)}
\DoxyCodeLine{00039\ \ \ \ \ udp.sendto(f\textcolor{stringliteral}{"{}IMG\ \{handle\}\ \{dest\_handle\}\ \{tcp\_port\}\ \{size\}"{}}.encode(\textcolor{stringliteral}{"{}utf-\/8"{}}),\ (peer\_ip,\ peer\_port))}
\DoxyCodeLine{00040\ \ \ \ \ udp.close()}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{def\ }\_serve():}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ conn,\ \_\ =\ server.accept()}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ conn.sendall(data)}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ conn.close()}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ server.close()}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ threading.Thread(target=\_serve,\ daemon=\textcolor{keyword}{True}).start()}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ }

\end{DoxyCode}


\label{doc-var-members}
\Hypertarget{namespacenetwork_doc-var-members}
\doxysubsection{Variable Documentation}
\Hypertarget{namespacenetwork_a761bf8a9cd29d8e3f0f59e7733bcd083}\index{network@{network}!MAX\_UDP\_SIZE@{MAX\_UDP\_SIZE}}
\index{MAX\_UDP\_SIZE@{MAX\_UDP\_SIZE}!network@{network}}
\doxysubsubsection{\texorpdfstring{MAX\_UDP\_SIZE}{MAX\_UDP\_SIZE}}
{\footnotesize\ttfamily \label{namespacenetwork_a761bf8a9cd29d8e3f0f59e7733bcd083} 
int network.\+MAX\+\_\+\+UDP\+\_\+\+SIZE = 65507}



Definition at line \mbox{\hyperlink{network_8py_source_l00016}{16}} of file \mbox{\hyperlink{network_8py_source}{network.\+py}}.

